{"version":3,"file":"commonHelpers.js","sources":["../src/js/index.js"],"sourcesContent":["import axios from 'axios';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport iziToast from 'izitoast';\n\nconst pixabayAPI = {\n  baseUrl: 'https://pixabay.com/api/',\n  key: '40817348-8cf9cc617061525653a12724b',\n  image_type: 'photo',\n  orientation: 'horizontal',\n  safesearch: 'true',\n  order: 'popular',\n  page: '1',\n  per_page: '40',\n};\n\nconst searchForm = document.querySelector('.search-form');\nconst gallerySelector = document.querySelector('.gallery');\nconst btnLoadMore = document.querySelector('.load-more');\n\nconst markupData = {\n  markup: '',\n  htmlCode: '',\n};\n\nlet searchQueryResult = '';\nlet q = '';\nlet pageN = 1;\nconst gallery = new SimpleLightbox('.gallery a', {\n  enableKeyboard: true,\n});\n\nsearchForm.addEventListener('submit', async e => {\n  e.preventDefault();\n\n  const {\n    elements: { searchQuery },\n  } = e.target;\n  searchQueryResult = searchQuery.value.trim();\n\n  if (searchQueryResult === '') {\n    gallerySelector.innerHTML = '';\n    iziToast.error({\n      title: 'Error',\n      message:\n        'Sorry, there are no images matching your search query. Please try again.',\n    });\n    return;\n  }\n\n  if (searchQueryResult !== q) {\n    pageN = 1;\n    pixabayAPI.page = `${pageN}`;\n    gallerySelector.innerHTML = '';\n    btnLoadMore.classList.remove('is-visible');\n  } else {\n    pageN += 1;\n    pixabayAPI.page = `${pageN}`;\n    btnLoadMore.classList.remove('is-visible');\n  }\n\n  q = searchQueryResult;\n\n  try {\n    const results = await fetchPhotos(searchQueryResult);\n    markupData.htmlCode = await createMarkup(results);\n    gallerySelector.insertAdjacentHTML('beforeend', markupData.htmlCode);\n    gallery.refresh();\n\n    const { page, per_page } = pixabayAPI;\n    const { totalHits } = results;\n    const totalPages = Math.ceil(totalHits / per_page);\n\n    if (page <= totalPages) {\n      btnLoadMore.classList.remove('is-visible');\n    }\n\n    iziToast.success({\n      title: 'Success',\n      message: `Hooray! We found ${totalHits} images.`,\n    });\n  } catch (error) {\n    btnLoadMore.classList.add('is-visible');\n    iziToast.error({\n      title: 'Error',\n      message:\n        'Sorry, there are no images matching your search query. Please try again.',\n    });\n  } finally {\n    searchForm.reset();\n  }\n});\n\nbtnLoadMore.addEventListener('click', async () => {\n  pageN += 1;\n  pixabayAPI.page = `${pageN}`;\n\n  try {\n    const results = await fetchPhotos(searchQueryResult);\n    markupData.htmlCode = await createMarkup(results);\n    gallerySelector.insertAdjacentHTML('beforeend', markupData.htmlCode);\n    btnLoadMore.classList.add('is-visible');\n    gallery.refresh();\n\n    const { page, per_page } = pixabayAPI;\n    const { totalHits } = results;\n    const totalPages = Math.ceil(totalHits / per_page);\n\n    if (page <= totalPages) {\n      btnLoadMore.classList.remove('is-visible');\n    }\n  } catch (error) {\n    iziToast.error({\n      title: 'Error',\n      message: \"We're sorry, but you've reached the end of search results.\",\n    });\n  }\n});\n\nasync function fetchPhotos(searchQueryResult) {\n  const {\n    baseUrl,\n    key,\n    image_type,\n    orientation,\n    safesearch,\n    order,\n    page,\n    per_page,\n  } = pixabayAPI;\n  pixabayAPI.page = `${pageN}`;\n\n  const response = await axios.get(\n    `${baseUrl}?key=${key}&q=${searchQueryResult}&image_type=${image_type}&orientation=${orientation}&safesearch=${safesearch}&order=${order}&page=${page}&per_page=${per_page}`\n  );\n  const results = response.data;\n\n  const { totalHits } = results;\n  const totalPages = Math.ceil(totalHits / per_page);\n\n  if (totalHits === 0) {\n    throw new Error();\n  }\n\n  if (page > totalPages) {\n    iziToast.error({\n      title: 'Error',\n      message: \"We're sorry, but you've reached the end of search results.\",\n    });\n  }\n\n  return results;\n}\n\nasync function createMarkup(results) {\n  markupData.markup = results.hits\n    .map(\n      hit =>\n        `<a href=\"${hit.largeImageURL}\" class=\"card-link js-card-link\" ><div class=\"photo-card\">\n        <img src=\"${hit.webformatURL}\" alt=\"${hit.tags}\" loading=\"lazy\"\n        class=\"photo\"/>\n        <div class=\"info\">\n    <p class=\"info-item\">\n      <b>Likes:</b>${hit.likes}\n    </p>\n    <p class=\"info-item\">\n      <b>Views:</b>${hit.views}\n    </p>\n    <p class=\"info-item\">\n      <b>Comments:</b>${hit.comments}\n    </p>\n    <p class=\"info-item\">\n      <b>Downloads:</b>${hit.downloads}\n    </p>\n  </div>\n</div></a>`\n    )\n    .join('');\n\n  return markupData.markup;\n}\n"],"names":["pixabayAPI","searchForm","gallerySelector","btnLoadMore","markupData","searchQueryResult","q","pageN","gallery","SimpleLightbox","e","searchQuery","iziToast","results","fetchPhotos","createMarkup","page","per_page","totalHits","totalPages","baseUrl","key","image_type","orientation","safesearch","order","axios","hit"],"mappings":"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"}